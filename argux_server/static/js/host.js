$(function(){function e(){o=setTimeout(host.get_host_items,1e4,{hostname:ARGUX_HOST,page:l,success:a,complete:e})}function a(e){var a=$("#objects");a.empty(),"host.metrics"===ARGUX_ACTION&&t(e),"host.notes"===ARGUX_ACTION&&s(e)}function t(e){var a={},t={},s={};e.items.sort(function(e,a){return e.name<a.name?-1:e.name>a.name?1:0}),$.each(e.items,function(e,s){var l="global",o=s.key,n="unknown",i="-",c="",d="";if(null!==s.category&&(l=s.category),null!==s.name&&(o=s.name),null!==s.unit&&(c=s.unit.symbol),void 0!==s.last_ts&&(i=s.last_ts),void 0!==s.last_val&&(n=s.last_val,""!==c)){switch(.1>n&&(d="m"),1e-4>n&&(d="&micro;"),n>100&&(d="k"),n>1e5&&(d="M"),n>1e8&&(d="G"),d){case"&micro;":n=1e6*n;break;case"m":n=1e3*n}n=Math.round(100*n)/100}t.hasOwnProperty(l)===!1&&(t[l]="");var r=ARGUX_BASE+"/host/"+ARGUX_HOST+"/item/"+s.key;a[l]+='<tr><td><a href="'+r+'"><span  data-toggle="tooltip" title="'+s.key+'">'+o+"</span></a></td><td>"+n+" "+d+c+'</td><td class="hidden-xs" data-toggle="tooltip" title="'+i+'">'+moment(i).fromNow()+'</td><td class="item-details"><a href="'+r+'/bookmark" aria-label="Bookmark"><span class="glyphicon glyphicon-bookmark" aria-hidden="true"></span></a></td></tr>'}),$("#objects div.collapse").each(function(e,a){var t=a.id.substring(12);s[t]=$(this).hasClass("in")});for(var l in a)a.hasOwnProperty(l)&&($("#objects").append('<div class="panel panel-default"><div class="panel-heading metric-category"><a data-toggle="collapse" data-target="#table-items-'+l+'">'+l+' <span class="badge">'+t[l]+'</span></a></div><div class="collapse in" id="table-items-'+l+'"><table class="table table-striped table-condensed"><thead><tr><th>Name</th><th class="col-xs-2">Value</th><th class="col-sm-3 hidden-xs">Timestamp</th><th class="col-xs-2 col-sm-1"></th></tr></thead><tbody><tbody id="items-'+l+'"></tbody></table></div></div>'),s[l]===!1&&$("#table-items-"+l).removeClass("in"),$("#items-"+l).append(a[l]))}function s(e){var a=e.note_count/e.page_size-1;if(e.note_count>e.page_size){for($("#pager").removeClass("hidden"),$("#pager").children(".page").remove(),i=0;i<e.note_count/e.page_size;++i)i==e.page?$("#pager").children(".next").before('<li class="page disabled active"><a href="#" class="page">'+(i+1)+"</a></li>"):$("#pager").children(".next").before('<li class="page"><a href="#" class="page">'+(i+1)+"</a></li>");0===parseInt(e.page)?$("#pager").children(".previous").addClass("disabled"):$("#pager").children(".previous").removeClass("disabled"),parseInt(e.page)===a?$("#pager").children(".next").addClass("disabled"):$("#pager").children(".next").removeClass("disabled"),$("a.page").click(function(){l=$(this).text()-1,o&&clearTimeout(o),host.get_notes({hostname:ARGUX_HOST,page:l,success:get_notes_success_callback,complete:get_notes_complete_callback})})}else $("#pager").addClass("hidden");$.each(e.notes,function(e,a){var t=moment(a.timestamp);$("#objects").append('<div class="panel panel-default"><div class="panel-heading">'+a.subject+'</div><div class="panel-body"><p>'+a.message+'</p><div class="xs" data-toggle="tooltip" title="'+t.toLocaleString()+'"><span class="small pull-right">'+t.fromNow()+"</span></div></div></div>")})}var l=0,o=null;"host.metrics"===ARGUX_ACTION&&host.get_host({hostname:ARGUX_HOST,items:"true",page:l,success:a,complete:e}),"host.notes"===ARGUX_ACTION&&($("#notes-form").submit(function(e){e.preventDefault();var a=$("#note-subject").val(),t=$("#note-body").val();""!==a&&""!==t&&host.create_note({hostname:ARGUX_HOST,message:t,subject:a,error:function(e){$("#alerts").empty(),$("#alerts").append('<div class="alert alert-danger alert-dismissible"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Problem:</strong> Creating new Note failed.</div>')},complete:function(e){$("#new-note-modal").modal("hide")}})}),host.get_host({hostname:ARGUX_HOST,notes:"true",page:l,success:a,complete:e})),$("#host_detail_btn").click(function(e){var a=$("#host_detail_btn > span");$("#host_detail").toggleClass("hidden"),$("#host_detail").is(".hidden")?(a.addClass("glyphicon-chevron-up"),a.removeClass("glyphicon-chevron-down")):(a.addClass("glyphicon-chevron-down"),a.removeClass("glyphicon-chevron-up"))})});