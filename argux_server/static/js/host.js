$(function(){function e(e){var t={},a={},s={},o=$("#objects");o.empty(),e.items.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),$.each(e.items,function(e,s){var o="global",l=s.key,n="unknown",i="-",d="",c="";if(null!==s.category&&(o=s.category),null!==s.name&&(l=s.name),null!==s.unit&&(d=s.unit.symbol),void 0!==s.last_ts&&(i=s.last_ts),void 0!==s.last_val&&(n=s.last_val,""!==d)){switch(.1>n&&(c="m"),1e-4>n&&(c="&micro;"),n>100&&(c="k"),n>1e5&&(c="M"),n>1e8&&(c="G"),c){case"&micro;":n=1e6*n;break;case"m":n=1e3*n}n=Math.round(100*n)/100}a.hasOwnProperty(o)===!1&&(a[o]="");var r=ARGUX_BASE+"/host/"+ARGUX_HOST+"/item/"+s.key;t[o]+='<tr><td><a href="'+r+'"><span  data-toggle="tooltip" title="'+s.key+'">'+l+"</span></a></td><td>"+n+" "+c+d+'</td><td class="hidden-xs" data-toggle="tooltip" title="'+i+'">'+moment(i).fromNow()+'</td><td class="item-details"><a href="'+r+'/bookmark" aria-label="Bookmark"><span class="glyphicon glyphicon-bookmark" aria-hidden="true"></span></a></td></tr>'}),$("#objects div.collapse").each(function(e,t){var a=t.id.substring(12);s[a]=$(this).hasClass("in")}),$("#objects").empty();for(var l in t)t.hasOwnProperty(l)&&($("#objects").append('<div class="panel panel-default"><div class="panel-heading metric-category"><a data-toggle="collapse" data-target="#table-items-'+l+'">'+l+' <span class="badge">'+a[l]+'</span></a></div><div class="collapse in" id="table-items-'+l+'"><table class="table table-striped table-condensed"><thead><tr><th>Name</th><th class="col-xs-2">Value</th><th class="col-sm-3 hidden-xs">Timestamp</th><th class="col-xs-2 col-sm-1"></th></tr></thead><tbody><tbody id="items-'+l+'"></tbody></table></div></div>'),s[l]===!1&&$("#table-items-"+l).removeClass("in"),$("#items-"+l).append(t[l]))}function t(){setTimeout(host.get_host_items,1e4,{hostname:ARGUX_HOST,success:e,complete:t})}function a(e){$("#objects").empty();var t=e.note_count/e.page_size-1;if(e.note_count>e.page_size){for($("#pager").removeClass("hidden"),$("#pager").children(".page").remove(),i=0;i<e.note_count/e.page_size;++i)i==e.page?$("#pager").children(".next").before('<li class="page disabled active"><a href="#" class="page">'+(i+1)+"</a></li>"):$("#pager").children(".next").before('<li class="page"><a href="#" class="page">'+(i+1)+"</a></li>");0===parseInt(e.page)?$("#pager").children(".previous").addClass("disabled"):$("#pager").children(".previous").removeClass("disabled"),parseInt(e.page)===t?$("#pager").children(".next").addClass("disabled"):$("#pager").children(".next").removeClass("disabled"),$("a.page").click(function(){o=$(this).text()-1,l&&clearTimeout(l),host.get_notes({hostname:ARGUX_HOST,page:o,success:a,complete:s})})}else $("#pager").addClass("hidden");$.each(e.notes,function(e,t){var a=moment(t.timestamp);$("#objects").append('<div class="panel panel-default"><div class="panel-heading">'+t.subject+'</div><div class="panel-body"><p>'+t.message+'</p><div class="xs" data-toggle="tooltip" title="'+a.toLocaleString()+'"><span class="small pull-right">'+a.fromNow()+"</span></div></div></div>")})}function s(){l=setTimeout(host.get_notes,1e4,{hostname:ARGUX_HOST,page:o,success:a,complete:s})}var o=0,l=null;"host.metrics"===ARGUX_ACTION&&host.get_host_items({hostname:ARGUX_HOST,page:o,success:e,complete:t}),"host.notes"===ARGUX_ACTION&&($("#notes-form").submit(function(e){e.preventDefault();var t=$("#note-subject").val(),a=$("#note-body").val();""!==t&&""!==a&&host.create_note({hostname:ARGUX_HOST,message:a,subject:t,error:function(e){$("#alerts").empty(),$("#alerts").append('<div class="alert alert-danger alert-dismissible"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Problem:</strong> Creating new Note failed.</div>')},complete:function(e){$("#new-note-modal").modal("hide")}})}),host.get_notes({hostname:ARGUX_HOST,success:a,complete:s})),$("#host_detail_btn").click(function(e){var t=$("#host_detail_btn > span");$("#host_detail").toggleClass("hidden"),$("#host_detail").is(".hidden")?(t.addClass("glyphicon-chevron-up"),t.removeClass("glyphicon-chevron-down")):(t.addClass("glyphicon-chevron-down"),t.removeClass("glyphicon-chevron-up"))})});