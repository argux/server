var ctx=null,overviewChart=null;$(function(){function t(t){$("#objects").empty(),$("#source-groups").empty(),t.groups=t.groups.sort(function(t,e){return t.name>=e.name}),$.each(t.groups,function(t,e){var s=e.total-e.warning-e.critical;0===e.total?(okay_class="",warning_class="",critical_class=""):(s>0?okay_class="success":okay_class="",e.warning>0?warning_class="warning":warning_class="success",e.critical>0?critical_class="danger":critical_class="success"),$("#objects").append('<tr><td><a href="'+ARGUX_BASE+"/hosts/groups/"+e.name+'">'+e.name+'</a></td><td class="'+okay_class+'">'+s+'</td><td class="'+warning_class+'">'+e.warning+'</td><td class="'+critical_class+'">'+e.critical+"</td></tr>"),"All"!==e.name&&$("#source-groups").append($("<option></option>").attr("value",e.name).text(e.name))})}function e(t){$("#source-hosts").empty(),t.hosts=t.hosts.sort(function(t,e){return t.name>=e.name}),$.each(t.hosts,function(t,e){$("#source-hosts").append($("<option></option>").attr("value",e.name).text(e.name))})}function s(t){var e=0,s=[0,0,0,0];$("#objects").empty(),t.hosts=t.hosts.sort(function(t,e){return t.name>=e.name}),$.each(t.hosts,function(t,o){$("#objects").append('<tr><td><a href="'+ARGUX_BASE+"/host/"+o.name+'">'+o.name+'</a></td><td><a href="'+ARGUX_BASE+"/host/"+o.name+'/metrics">'+o.n_items+'</a></td><td><a href="'+ARGUX_BASE+"/host/"+o.name+'/alerts">'+o.active_alerts+"</a></td></tr>"),"crit"===o.severity?s[2]+=1:"warn"===o.severity?s[1]+=1:"info"===o.severity?s[3]+=1:s[0]+=1,e+=o.active_alerts}),host_overview_chart_config.data.datasets[0].data=s,e>0?$("#alert_count").text(e):$("#alert_count").text(""),overviewChart.update()}function o(e,s,o){if(201!==e.status){var a=$(".modal-form-alerts");a.empty(),a.append('<div class="alert alert-danger alert-dismissible"><strong>Problem:</strong> '+e.responseJSON.message)}else $("#create-host-modal").modal("hide"),$("#create-hostgroup-modal").modal("hide"),host.get_groups({success:t})}function a(){setTimeout(host.get_host_overview,1e4,{success:s,complete:a})}"overview"===ARGUX_ACTION&&(ctx=document.getElementById("overview").getContext("2d"),overviewChart=new Chart(ctx,host_overview_chart_config),host.get_host_overview({success:s,complete:a})),"groups"===ARGUX_ACTION&&(host.get_groups({success:t}),host.get_group_members({group:"All",success:e}),$("#add-group").click(function(t){t.preventDefault(),$("#source-groups option:selected").each(function(){$("#dst-groups").append(this)})}),$("#remove-group").click(function(t){t.preventDefault(),$("#dst-groups option:selected").each(function(){$("#source-groups").append(this)})}),$("#new-host-form").submit(function(t){t.preventDefault(),groups=[],$("#dst-groups option:selected").each(function(){groups.push(this.value)}),host.create_host({hostname:$("#host-name").val(),description:$("#host-description").val(),groups:groups,error:o})}),$("#add-host").click(function(t){t.preventDefault(),$("#source-hosts option:selected").each(function(){$("#dst-hosts").append(this)})}),$("#remove-host").click(function(t){t.preventDefault(),$("#dst-hosts option:selected").each(function(){$("#source-hosts").append(this)})}),$("#new-hostgroup-form").submit(function(t){t.preventDefault(),hosts=[],$("#dst-hosts option:selected").each(function(){hosts.push(this.value)}),host.create_group({group:$("#hostgroup-name").val(),hosts:hosts,error:o})}))});
